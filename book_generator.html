<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì˜ì–´ì±… ìƒì„±ê¸°</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="style.css">
    <style>
        body {
            padding: 40px 20px;
        }

        .generator-container {
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        .generator-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .subtitle {
            color: white;
            font-size: 1.1rem;
            margin-top: 10px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .form-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 25px rgba(147, 112, 219, 0.3);
            margin-bottom: 30px;
        }

        .form-section {
            margin-bottom: 30px;
        }

        .form-label {
            display: block;
            font-size: 1.2rem;
            font-weight: bold;
            color: #6B46C1;
            margin-bottom: 10px;
        }

        .form-hint {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 10px;
            padding: 10px;
            background: rgba(147, 112, 219, 0.1);
            border-radius: 10px;
        }

        .form-input,
        .form-textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid rgba(147, 112, 219, 0.3);
            border-radius: 10px;
            font-size: 1rem;
            font-family: 'Noto Sans KR', sans-serif;
            transition: all 0.3s ease;
        }

        .form-input:focus,
        .form-textarea:focus {
            outline: none;
            border-color: #6B46C1;
            box-shadow: 0 0 0 3px rgba(147, 112, 219, 0.2);
        }

        .form-textarea {
            min-height: 200px;
            resize: vertical;
            font-family: 'Courier New', monospace;
            line-height: 1.8;
        }

        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .gen-btn {
            padding: 15px 30px;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Noto Sans KR', sans-serif;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .gen-btn-primary {
            background: linear-gradient(135deg, #6B46C1, #9370DB);
            color: white;
        }

        .gen-btn-secondary {
            background: linear-gradient(135deg, #4CAF50, #66BB6A);
            color: white;
        }

        .gen-btn-tertiary {
            background: linear-gradient(135deg, #FF9800, #FFB74D);
            color: white;
        }

        .gen-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .example-data {
            background: rgba(255, 248, 220, 0.5);
            border-left: 4px solid #FFB74D;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
        }

        .example-title {
            font-weight: bold;
            color: #FF9800;
            margin-bottom: 8px;
        }

        .icon-selector {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .icon-option {
            font-size: 2rem;
            padding: 15px;
            text-align: center;
            background: rgba(255, 255, 255, 0.8);
            border: 2px solid transparent;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .icon-option:hover {
            transform: scale(1.1);
            border-color: #6B46C1;
        }

        .icon-option.selected {
            background: rgba(147, 112, 219, 0.2);
            border-color: #6B46C1;
            box-shadow: 0 0 0 3px rgba(147, 112, 219, 0.2);
        }

        .preview-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 25px rgba(147, 112, 219, 0.3);
        }

        .preview-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #6B46C1;
            margin-bottom: 20px;
            text-align: center;
        }

        .output-code {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            line-height: 1.6;
            max-height: 500px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
    </style>
</head>

<body>
    <!-- Stars Background -->
    <div class="stars" id="stars"></div>

    <div class="generator-container">
        <div class="generator-header">
            <h1>âœ¨ ì˜ì–´ì±… ìƒì„±ê¸° âœ¨</h1>
            <p class="subtitle">í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ë©´ ìë™ìœ¼ë¡œ ì˜ì–´ì±… HTMLì„ ë§Œë“¤ì–´ë“œë ¤ìš”!</p>
        </div>

        <div class="form-container">
            <!-- Book Info -->
            <div class="form-section">
                <label class="form-label">ğŸ“– ì±… ì œëª© (ì˜ì–´)</label>
                <input type="text" class="form-input" id="book-title" placeholder="Yulia's Magic Camera">
            </div>

            <div class="form-section">
                <label class="form-label">ğŸ“ ì±… ì„¤ëª… (í•œê¸€)</label>
                <input type="text" class="form-input" id="book-description" placeholder="ìœ¨ì´ì˜ ë§ˆë²• ì¹´ë©”ë¼ ì´ì•¼ê¸°">
            </div>

            <div class="form-section">
                <label class="form-label">ğŸ”– ì±… ID (ì˜ë¬¸/ìˆ«ìë§Œ, ê³µë°±ì—†ì´)</label>
                <div class="form-hint">ì˜ˆ: camera_story, pete_goldfish, unicorn_stevie</div>
                <input type="text" class="form-input" id="book-id" placeholder="camera_story">
            </div>

            <div class="form-section">
                <label class="form-label">ğŸ¨ ì±… ì•„ì´ì½˜ ì„ íƒ</label>
                <div class="icon-selector" id="icon-selector">
                    <div class="icon-option selected" data-icon="ğŸ“š">ğŸ“š</div>
                    <div class="icon-option" data-icon="ğŸ“–">ğŸ“–</div>
                    <div class="icon-option" data-icon="ğŸ“·">ğŸ“·</div>
                    <div class="icon-option" data-icon="ğŸ±">ğŸ±</div>
                    <div class="icon-option" data-icon="ğŸ¦„">ğŸ¦„</div>
                    <div class="icon-option" data-icon="ğŸ ">ğŸ </div>
                    <div class="icon-option" data-icon="ğŸ¨">ğŸ¨</div>
                    <div class="icon-option" data-icon="ğŸš²">ğŸš²</div>
                    <div class="icon-option" data-icon="ğŸŒŸ">ğŸŒŸ</div>
                    <div class="icon-option" data-icon="ğŸµ">ğŸµ</div>
                    <div class="icon-option" data-icon="ğŸŒˆ">ğŸŒˆ</div>
                    <div class="icon-option" data-icon="ğŸª">ğŸª</div>
                </div>
            </div>

            <!-- Story Content -->
            <div class="form-section">
                <label class="form-label">ğŸ“œ ì´ì•¼ê¸° ë‚´ìš©</label>
                <div class="form-hint">
                    í˜•ì‹: <code>ì˜ì–´ ë¬¸ì¥ | í•œê¸€ ë²ˆì—­</code> (í•œ ì¤„ì— í•˜ë‚˜ì”©)<br>
                    ì£¼ìš” ë‹¨ì–´ëŠ” ì•„ë˜ ë‹¨ì–´ ëª©ë¡ì— ì¶”ê°€í•˜ì„¸ìš”
                </div>
                <textarea class="form-textarea" id="story-content" placeholder="This is a lovely girl named Cho Yulia. | ì´ ì†Œë…€ëŠ” ì‚¬ë‘ìŠ¤ëŸ¬ìš´ ì¡°ìœ¨ì…ë‹ˆë‹¤.
Yulia loves her pink rabbit doll, Toto. | ìœ¨ì´ëŠ” ë¶„í™ìƒ‰ í† ë¼ ì¸í˜• í† í† ë¥¼ ì •ë§ ì¢‹ì•„í•´ìš”."></textarea>

                <div class="example-data">
                    <div class="example-title">ğŸ’¡ ì˜ˆì‹œ ë°ì´í„°</div>
                    <button class="gen-btn gen-btn-tertiary" onclick="loadExampleStory()"
                        style="padding: 8px 16px; font-size: 0.9rem;">ì˜ˆì‹œ ë¶ˆëŸ¬ì˜¤ê¸°</button>
                </div>
            </div>

            <!-- Vocabulary -->
            <div class="form-section">
                <label class="form-label">ğŸ“š ë‹¨ì–´ ëª©ë¡</label>
                <div class="form-hint">
                    í˜•ì‹: <code>ë‹¨ì–´ | í•œê¸€ ëœ» | ì˜ˆë¬¸</code> (í•œ ì¤„ì— í•˜ë‚˜ì”©)
                </div>
                <textarea class="form-textarea" id="vocabulary-content" placeholder="lovely | ì‚¬ë‘ìŠ¤ëŸ¬ìš´ | This is a lovely girl.
camera | ì¹´ë©”ë¼ | It is a shiny white camera." style="min-height: 150px;"></textarea>

                <div class="example-data">
                    <div class="example-title">ğŸ’¡ ì˜ˆì‹œ ë°ì´í„°</div>
                    <button class="gen-btn gen-btn-tertiary" onclick="loadExampleVocab()"
                        style="padding: 8px 16px; font-size: 0.9rem;">ì˜ˆì‹œ ë¶ˆëŸ¬ì˜¤ê¸°</button>
                </div>
            </div>

            <!-- Buttons -->
            <div class="button-group">
                <button class="gen-btn gen-btn-primary" onclick="generateBook()">ğŸ‰ ì±… ìƒì„±í•˜ê¸°</button>
                <button class="gen-btn gen-btn-secondary" onclick="downloadBook()">ğŸ’¾ HTML ë‹¤ìš´ë¡œë“œ</button>
                <button class="gen-btn gen-btn-tertiary" onclick="location.reload()">ğŸ”„ ì´ˆê¸°í™”</button>
            </div>
        </div>

        <!-- Preview -->
        <div class="preview-section" id="preview-section" style="display: none;">
            <div class="preview-title">ìƒì„±ëœ HTML ì½”ë“œ</div>
            <div class="output-code" id="output-code"></div>
            <div class="button-group" style="margin-top: 20px;">
                <button class="gen-btn gen-btn-secondary" onclick="copyToClipboard()">ğŸ“‹ ë³µì‚¬í•˜ê¸°</button>
                <button class="gen-btn gen-btn-primary" onclick="downloadBook()">ğŸ’¾ ë‹¤ìš´ë¡œë“œ</button>
            </div>
        </div>
    </div>

    <script>
        let selectedIcon = 'ğŸ“š';
        let generatedHTML = '';

        // Create stars
        const starsContainer = document.getElementById('stars');
        const numberOfStars = 50;
        for (let i = 0; i < numberOfStars; i++) {
            const star = document.createElement('div');
            star.className = 'star';
            star.style.left = Math.random() * 100 + '%';
            star.style.top = Math.random() * 100 + '%';
            star.style.animationDelay = Math.random() * 3 + 's';
            starsContainer.appendChild(star);
        }

        // Icon selection
        document.querySelectorAll('.icon-option').forEach(option => {
            option.addEventListener('click', () => {
                document.querySelectorAll('.icon-option').forEach(o => o.classList.remove('selected'));
                option.classList.add('selected');
                selectedIcon = option.dataset.icon;
            });
        });

        // Load example data
        function loadExampleStory() {
            document.getElementById('story-content').value = `This is a lovely girl named Cho Yulia. | ì´ ì†Œë…€ëŠ” ì‚¬ë‘ìŠ¤ëŸ¬ìš´ ì¡°ìœ¨ì…ë‹ˆë‹¤.
Yulia loves her pink rabbit doll, Toto. | ìœ¨ì´ëŠ” ë¶„í™ìƒ‰ í† ë¼ ì¸í˜• í† í† ë¥¼ ì •ë§ ì¢‹ì•„í•´ìš”.
Yulia has a special friend. | ìœ¨ì´ì—ê²ŒëŠ” íŠ¹ë³„í•œ ì¹œêµ¬ê°€ ìˆì–´ìš”.
It is a camera! A shiny, white Instax Mini. | ê·¸ê±´ ë°”ë¡œ ì¹´ë©”ë¼ì˜ˆìš”! ë°˜ì§ì´ëŠ” í•˜ì–€ìƒ‰ ì¸ìŠ¤íƒìŠ¤ ë¯¸ë‹ˆì£ .`;
        }

        function loadExampleVocab() {
            document.getElementById('vocabulary-content').value = `lovely | ì‚¬ë‘ìŠ¤ëŸ¬ìš´ | This is a lovely girl.
special | íŠ¹ë³„í•œ | Yulia has a special friend.
camera | ì¹´ë©”ë¼ | It is a shiny white camera.
shiny | ë°˜ì§ì´ëŠ” | A shiny, white Instax Mini.`;
        }

        // Parse input
        function parseStory(text) {
            const lines = text.trim().split('\n').filter(line => line.trim());
            const vocab = parseVocabulary(document.getElementById('vocabulary-content').value);
            const vocabWords = vocab.map(v => v.word.toLowerCase());

            return lines.map(line => {
                const [en, ko] = line.split('|').map(s => s.trim());

                // Find highlight words
                const highlightWords = [];
                vocabWords.forEach(word => {
                    const regex = new RegExp(`\\b${word}\\b`, 'gi');
                    if (regex.test(en)) {
                        highlightWords.push(word);
                    }
                });

                return { en, ko, highlightWords };
            });
        }

        function parseVocabulary(text) {
            const lines = text.trim().split('\n').filter(line => line.trim());
            return lines.map(line => {
                const [word, meaning, example] = line.split('|').map(s => s.trim());
                return { word, meaning, example };
            });
        }

        // Generate book HTML
        function generateBook() {
            const title = document.getElementById('book-title').value || 'My English Book';
            const description = document.getElementById('book-description').value || 'ì˜ì–´ í•™ìŠµ ì±…';
            const bookId = document.getElementById('book-id').value || 'my_book';
            const storyText = document.getElementById('story-content').value;
            const vocabText = document.getElementById('vocabulary-content').value;

            if (!storyText || !vocabText) {
                alert('ì´ì•¼ê¸° ë‚´ìš©ê³¼ ë‹¨ì–´ ëª©ë¡ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return;
            }

            const story = parseStory(storyText);
            const vocabulary = parseVocabulary(vocabText);

            const storyJSON = JSON.stringify(story, null, 2);
            const vocabularyJSON = JSON.stringify(vocabulary, null, 2);

            generatedHTML = `<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>${title}</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="book_style.css">
</head>

<body>
  <!-- Stars Background -->
  <div class="stars" id="stars"></div>

  <div class="container">
    <!-- Header -->
    <div class="header">
      <button class="back-button" onclick="window.history.back()">â† ë’¤ë¡œ</button>
      <div class="book-title">${selectedIcon} ${title}</div>
      <div class="speed-control">
        <button class="speed-btn" data-speed="0.8">ğŸ¢</button>
        <button class="speed-btn active" data-speed="1.0">â—</button>
        <button class="speed-btn" data-speed="1.2">ğŸ‡</button>
      </div>
    </div>

    <!-- Tabs -->
    <div class="tabs">
      <button class="tab-btn active" data-tab="read">ğŸ“– ì½ê¸°</button>
      <button class="tab-btn" data-tab="words">ğŸ“ ë‹¨ì–´</button>
      <button class="tab-btn" data-tab="review">ğŸ“Š ë³µìŠµ</button>
    </div>

    <!-- Read Tab -->
    <div id="read-tab" class="tab-content active">
      <div class="read-mode">
        <div id="sentences-container"></div>
        
        <div class="controls">
          <button class="control-btn" id="toggle-korean">í•œê¸€ ìˆ¨ê¸°ê¸°</button>
        </div>
        
        <div class="progress-bar">
          <div class="progress-fill" style="width: 0%"></div>
        </div>
        <div class="progress-text">0 / ${story.length} ë¬¸ì¥</div>
      </div>
    </div>

    <!-- Words Tab -->
    <div id="words-tab" class="tab-content">
      <div class="word-mode">
        <div class="card-counter" id="card-counter">1 / ${vocabulary.length} ë‹¨ì–´</div>
        
        <div class="flashcard-container">
          <div class="flashcard" id="flashcard">
            <div class="word-front" id="word-front">
              <div class="word-text" id="word-text"></div>
              <div class="tap-hint">íƒ­í•˜ì—¬ ëœ» ë³´ê¸°</div>
            </div>
            
            <div class="word-back" id="word-back">
              <div class="word-text" id="word-text-back"></div>
              <div class="word-meaning" id="word-meaning"></div>
              <div class="word-example" id="word-example"></div>
            </div>
          </div>
        </div>
        
        <div class="answer-buttons">
          <button class="answer-btn know" id="know-btn">ğŸ˜Š ì•Œì•„ìš”!</button>
          <button class="answer-btn study" id="study-btn">ğŸ¤” ë” ë³¼ë˜ìš”</button>
        </div>
      </div>
    </div>

    <!-- Review Tab -->
    <div id="review-tab" class="tab-content">
      <div class="review-mode">
        <div class="review-header">
          <div class="review-title">í•™ìŠµ í˜„í™©</div>
          <div class="star-rating">â­â­â­â˜†â˜†</div>
        </div>

        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-value"><span id="completed-sentences">0</span>/<span id="total-sentences">${story.length}</span></div>
            <div class="stat-label">ì½ì€ ë¬¸ì¥</div>
          </div>
          <div class="stat-card">
            <div class="stat-value"><span id="mastered-words">0</span>/<span id="total-words">${vocabulary.length}</span></div>
            <div class="stat-label">ì™¸ìš´ ë‹¨ì–´</div>
          </div>
        </div>

        <div class="word-list-section">
          <div class="word-list-title">âœ“ í•™ìŠµí•œ ë‹¨ì–´</div>
          <div class="word-list" id="mastered-words-list">
            <div class="empty-message">ì•„ì§ í•™ìŠµí•œ ë‹¨ì–´ê°€ ì—†ì–´ìš”</div>
          </div>
        </div>

        <div class="word-list-section">
          <div class="word-list-title">ğŸ“š ë³µìŠµí•  ë‹¨ì–´</div>
          <div class="word-list" id="review-words-list">
            <div class="empty-message">ë³µìŠµí•  ë‹¨ì–´ê°€ ì—†ì–´ìš”</div>
          </div>
        </div>

        <div class="controls">
          <button class="control-btn" onclick="location.reload()">ì²˜ìŒë¶€í„° ë‹¤ì‹œ</button>
        </div>
      </div>
    </div>
  </div>

  <script src="book_reader_base.js"><` + `/script>
  <script>
    // Book Data
    const BOOK_DATA = {
      id: "${bookId}",
      title: "${title}",
      description: "${description}",
      story: ${storyJSON},
      vocabulary: ${vocabularyJSON}
    };

    // Initialize book reader
    const reader = initBookReader(BOOK_DATA);
  <` + `/script>
</body>

</html>`;


            // Show preview
            document.getElementById('output-code').textContent = generatedHTML;
            document.getElementById('preview-section').style.display = 'block';
            document.getElementById('preview-section').scrollIntoView({ behavior: 'smooth' });
        }

        // Download book
        function downloadBook() {
            if (!generatedHTML) {
                alert('ë¨¼ì € ì±…ì„ ìƒì„±í•´ì£¼ì„¸ìš”!');
                return;
            }

            const bookId = document.getElementById('book-id').value || 'my_book';
            const blob = new Blob([generatedHTML], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${bookId}.html`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Copy to clipboard
        function copyToClipboard() {
            if (!generatedHTML) {
                alert('ë¨¼ì € ì±…ì„ ìƒì„±í•´ì£¼ì„¸ìš”!');
                return;
            }

            navigator.clipboard.writeText(generatedHTML).then(() => {
                alert('í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            });
        }
    </script>
</body>

</html>